<!-- src/app/sale-form/sale-form.component.html -->

<form (ngSubmit)="submit()" novalidate class="container py-4">
    <h2 class="mb-4">Nova Venda</h2>

    <!-- Data da Venda (preenchida com a data atual) -->
    <div class="mb-3">
        <label for="saleDate" class="form-label">Data da venda</label>
        <input id="saleDate" type="date" class="form-control" [value]="saleDate() | date:'yyyy-MM-dd'" readonly />
    </div>

    <!-- Seleção de Cliente e Filial -->
    <div class="row mb-3">
        <div class="col-md-6">
            <label for="customer" class="form-label">Cliente</label>
            <select id="customer" class="form-select" [value]="customerId()"
                (change)="onCustomerChange($any($event.target).value)">
                <option value="">Selecione</option>
                <option *ngFor="let c of customers" [value]="c.id">
                    {{ c.name }}
                </option>
            </select>
        </div>
        <div class="col-md-6">
            <label for="branch" class="form-label">Filial</label>
            <select id="branch" class="form-select" [value]="branchId()"
                (change)="onBranchChange($any($event.target).value)">
                <option value="">Selecione</option>
                <option *ngFor="let b of branches" [value]="b.id">
                    {{ b.name }}
                </option>
            </select>
        </div>
    </div>

    <hr class="my-4" />
    <h5>Itens da Venda</h5>

    <!-- Lista de itens -->
    <div *ngFor="let it of items(); let i = index" class="mb-3">
        <app-sale-item-form [index]="i" [item]="it" (update)="updateItem($event)"
            (remove)="removeItem($event)"></app-sale-item-form>
    </div>

    <div class="mb-3 text-end">
        <button type="button" class="btn btn-outline-secondary" (click)="addItem()">
            <i class="bi bi-plus-circle me-1"></i> Adicionar Item
        </button>
    </div>

    <div *ngIf="error()" class="alert alert-danger">{{ error() }}</div>

    <div class="text-end">
        <button type="submit" class="btn btn-primary" [disabled]="!canSubmit() || submitting()">
            <i class="bi bi-save me-1"></i> Salvar Venda
        </button>
    </div>
</form>
  